'use client';

import { useCallback, useEffect, useState } from 'react';
import throttle from 'lodash/throttle';
import styled from 'styled-components';

const TRANSFORM_MULTIPLIER = 0.12;

const LAYER_TRANSFORM = {
  2: 4 * TRANSFORM_MULTIPLIER,
  3: 3 * TRANSFORM_MULTIPLIER,
  4: 2 * TRANSFORM_MULTIPLIER,
  5: TRANSFORM_MULTIPLIER,
};

const StyledSvg = styled.svg`
  width: auto;
  height: auto;
  min-width: 100vw;
  min-height: 200vh;
  position: relative;
  top: -30vh;
`;

export const Background = () => {
  const [scrollY, setScrollY] = useState(0);

  const onScroll = useCallback(() => {
    if (typeof window === 'undefined') return;

    const y = window.scrollY;
    const viewportHeight = window.innerHeight;

    setScrollY(y);

    if (y < viewportHeight) {
      setScrollY(y);
    } else {
      setScrollY(viewportHeight);
    }
  }, []);

  const throttledOnScroll = useCallback(throttle(onScroll, 3), [onScroll]);

  useEffect(() => {
    if (typeof window === 'undefined') {
      return;
    }

    window.addEventListener('scroll', throttledOnScroll);
    return () => {
      window.removeEventListener('scroll', throttledOnScroll);
    };
  }, [throttledOnScroll]);

  return (
    <StyledSvg
      width="1512"
      height="1514"
      viewBox="0 0 1512 1514"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <rect
        className="ground layer layer-1"
        width="1512"
        height="1513"
        fill="#9DD2E7"
      />
      <g
        className="layer layer-2"
        style={{
          transform: `translateY(${LAYER_TRANSFORM[2] * scrollY}px)`,
        }}
      >
        <path
          className="ground"
          d="M1512 333.5L1512 1509.39L0 1513L0 367.822C66.5 345.849 55.5 359.004 106 354C120.418 352.571 149.342 371.702 171.5 376.088C206.088 382.935 207.924 643.023 241 657C278.047 672.655 313.789 406.538 351 421.616C403.447 442.869 424.505 486.156 479.5 493.542C541.037 501.807 561.421 453.512 623 445.709C689.516 437.279 713.429 625.269 780 617.5C847.407 609.634 861.277 477.631 929 477.631C974 477.631 979.072 375.238 1023.5 375.238C1094 375.238 1133.52 343.285 1190.5 345.849C1228.47 347.558 1256.5 464 1294.5 464C1328.81 464 1474.5 327.649 1512 333.5Z"
          fill="#78B9CD"
        />
        <path
          className="hole"
          d="M1116.61 501.08C1110.11 501.1 1091.07 484.103 1084.81 483.838C1078.55 483.574 1060.17 497.219 1054.97 494.877C1049.77 492.535 1032.76 455.173 1034.47 448.222C1036.18 441.27 1052.42 421.489 1057.5 420.286C1062.58 419.083 1079.26 428.486 1084.32 427.056C1089.39 425.626 1091.37 415.368 1101.36 413.234C1111.34 411.101 1153.4 448.367 1153.55 456.273C1153.71 464.178 1123.1 501.061 1116.61 501.08Z"
          fill="#9DD2E7"
        />
      </g>
      <path
        style={{
          transform: `translateY(${LAYER_TRANSFORM[3] * scrollY}px)`,
        }}
        className="ground layer layer-3"
        d="M1512 257L1512 1510L0 1513L0 305C0 305 34.9907 398.752 49.5 387.5C68.7041 372.607 101.351 524.809 124 516C144.928 507.861 149.342 532.359 171.5 536C206.088 541.684 220.424 580.897 253.5 592.5C290.547 605.496 313.789 594.483 351 607C403.447 624.642 424.505 660.577 479.5 666.709C541.037 673.57 561.421 633.478 623 627C689.516 620.003 707.429 672.949 774 666.5C841.407 659.97 861.277 653.5 929 653.5C974 653.5 1039.07 568.5 1083.5 568.5C1154 568.5 1133.52 525.371 1190.5 527.5C1228.47 528.918 1286 555.5 1324 555.5C1384.5 555.5 1394.75 355.733 1445 377C1484.64 393.775 1512 257 1512 257Z"
        fill="#64A2BA"
      />
      <g
        className="layer layer-4"
        style={{
          transform: `translateY(${LAYER_TRANSFORM[4] * scrollY}px)`,
        }}
      >
        <g className="plant-4">
          <path
            d="M833.992 872.254C837.819 883.486 833.992 902.558 833.992 902.558H822.144C822.144 902.558 826.117 885.123 822.144 875.14C817.709 863.994 803.753 864.854 799.93 853.494C794.772 838.167 797.601 812.322 813.999 814.531C829.785 816.658 815.543 839.361 822.144 853.494C825.801 861.323 831.21 864.09 833.992 872.254Z"
            fill="#48938E"
          />
          <path
            d="M883.109 810.106C870.503 802.39 857.078 826.968 862.87 839.557C872.497 860.482 864.487 880.021 864.458 898H875.511C877.625 881.659 871.112 866.534 875.511 852.545C880.322 837.241 888.787 813.582 883.109 810.106Z"
            fill="#48938E"
          />
          <path
            d="M787.226 862.102C797.545 857.99 802.315 869.706 797.574 876.415C789.693 887.565 811.059 897.978 811.083 907.559H802.035C800.304 898.85 790.826 890.79 787.226 883.336C783.286 875.18 782.578 863.954 787.226 862.102Z"
            fill="#48938E"
          />
          <path
            d="M848.061 797.097C863.847 799.224 849.606 837.804 856.208 851.937C861.721 863.741 860.651 889.692 854.727 900.28H841.398C855.737 879.228 844.012 867.133 836.956 846.165C831.798 830.838 831.664 794.889 848.061 797.097Z"
            fill="#48938E"
          />
        </g>
        <g className="plant-4">
          <path
            d="M311.398 817.855C315.225 829.087 311.398 848.16 311.398 848.16H299.55C299.55 848.16 303.523 830.725 299.55 820.742C295.115 809.595 281.159 810.455 277.336 799.096C272.178 783.768 275.008 757.924 291.405 760.133C307.191 762.259 292.949 784.962 299.55 799.096C303.207 806.925 308.616 809.691 311.398 817.855Z"
            fill="#48938E"
          />
          <path
            d="M348.76 759.78C360.904 754.633 366.677 781.018 359.123 792.171C346.566 810.709 348.946 831.189 345.044 848.665L335.873 846.604C337.687 830.33 346.393 816.848 345.798 802.435C345.147 786.667 343.29 762.099 348.76 759.78Z"
            fill="#48938E"
          />
          <path
            d="M369.328 806.587C380.094 809.326 377.066 821.608 369.287 824.248C356.357 828.637 367.522 849.62 361.909 857.385L354.589 852.066C358.308 844.004 355.378 831.912 356.847 823.765C358.454 814.852 364.479 805.353 369.328 806.587Z"
            fill="#48938E"
          />
          <path
            d="M325.513 744.097C312.731 746.218 324.262 784.693 318.916 798.788C314.452 810.56 315.318 836.441 320.116 847H330.908C319.298 826.006 328.792 813.943 334.506 793.032C338.682 777.746 338.791 741.894 325.513 744.097Z"
            fill="#48938E"
          />
        </g>
        <g className="plant-4">
          <path
            d="M1309.99 768.254C1313.82 779.486 1309.99 798.558 1309.99 798.558H1298.14C1298.14 798.558 1302.12 781.123 1298.14 771.14C1293.71 759.994 1279.75 760.854 1275.93 749.494C1270.77 734.167 1273.6 708.322 1290 710.531C1305.78 712.658 1291.54 735.361 1298.14 749.494C1301.8 757.323 1307.21 760.09 1309.99 768.254Z"
            fill="#48938E"
          />
          <path
            d="M1359.11 712.106C1346.5 704.39 1333.08 728.968 1338.87 741.557C1348.5 762.482 1340.49 782.021 1340.46 800H1351.51C1353.63 783.659 1347.11 768.534 1351.51 754.545C1356.32 739.241 1364.79 715.582 1359.11 712.106Z"
            fill="#48938E"
          />
          <path
            d="M1262.23 753.102C1272.55 748.99 1277.31 760.706 1272.57 767.415C1264.69 778.565 1286.06 788.978 1286.08 798.559H1277.03C1275.3 789.85 1265.83 781.79 1262.23 774.336C1258.29 766.18 1257.58 754.954 1262.23 753.102Z"
            fill="#48938E"
          />
          <path
            d="M1324.06 696.097C1339.85 698.224 1325.61 736.804 1332.21 750.937C1337.72 762.741 1336.65 788.692 1330.73 799.28H1317.4C1331.74 778.228 1320.01 766.133 1312.96 745.165C1307.8 729.838 1307.66 693.889 1324.06 696.097Z"
            fill="#48938E"
          />
        </g>
        <path
          className="ground"
          d="M1512 497L1512 1510L0 1513L0 545C0 545 34.9907 638.752 49.5 627.5C68.7041 612.607 101.351 764.809 124 756C144.928 747.861 149.342 772.359 171.5 776C206.088 781.684 220.424 820.897 253.5 832.5C290.547 845.496 313.789 834.483 351 847C403.447 864.642 424.505 900.577 479.5 906.709C541.037 913.57 561.421 873.478 623 867C689.516 860.003 707.429 912.949 774 906.5C841.407 899.97 861.277 893.5 929 893.5C974 893.5 1039.07 808.5 1083.5 808.5C1154 808.5 1133.52 765.371 1190.5 767.5C1228.47 768.918 1286 795.5 1324 795.5C1384.5 795.5 1394.75 595.733 1445 617C1484.64 633.775 1512 497 1512 497Z"
          fill="#508AA0"
        />
      </g>
      <g
        className="layer layer-5"
        style={{
          transform: `translateY(${LAYER_TRANSFORM[5] * scrollY}px)`,
        }}
      >
        <g className="plant-5">
          <path
            d="M153.464 820.8C149.671 837.458 164.41 863.153 164.41 863.153H180.408C180.408 863.153 168.099 841.855 170.304 827.576C171.749 818.216 180.149 815.022 180.408 805.553C180.683 795.48 169.877 791.903 170.304 781.835C170.692 772.67 180.984 769.814 180.408 760.659C179.755 750.292 167.193 749.485 164.41 739.482C162.371 732.156 164.41 720 164.41 720C164.41 720 154.809 728.6 153.464 736.094C151.607 746.44 165.794 750.239 164.41 760.659C163.334 768.757 154.071 770.3 153.464 778.447C152.771 787.742 164.41 790.302 164.41 799.624C164.41 808.945 155.532 811.714 153.464 820.8Z"
            fill="#2F6D6C"
          />
          <path
            d="M183.895 838.922C181.349 851.539 191.244 871 191.244 871H201.985C201.985 871 193.721 854.868 195.201 844.054C196.172 836.965 201.811 834.545 201.985 827.374C202.17 819.744 194.915 817.035 195.201 809.41C195.462 802.469 202.372 800.305 201.985 793.371C201.547 785.519 193.113 784.908 191.244 777.332C189.875 771.783 191.244 762.576 191.244 762.576C191.244 762.576 184.798 769.09 183.895 774.766C182.649 782.602 192.174 785.479 191.244 793.371C190.522 799.504 184.303 800.673 183.895 806.844C183.431 813.884 191.244 815.823 191.244 822.883C191.244 829.943 185.284 832.04 183.895 838.922Z"
            fill="#2F6D6C"
          />
          <path
            d="M136.305 829.436C134.453 839.884 141.649 856 141.649 856H149.461C149.461 856 143.451 842.641 144.527 833.686C145.233 827.815 149.334 825.811 149.461 819.872C149.595 813.554 144.319 811.311 144.527 804.996C144.717 799.248 149.742 797.456 149.461 791.714C149.142 785.212 143.008 784.705 141.649 778.432C140.654 773.836 141.649 766.212 141.649 766.212C141.649 766.212 136.961 771.606 136.305 776.306C135.398 782.795 142.325 785.178 141.649 791.714C141.124 796.793 136.601 797.761 136.305 802.871C135.967 808.701 141.649 810.307 141.649 816.153C141.649 822 137.315 823.737 136.305 829.436Z"
            fill="#2F6D6C"
          />
        </g>
        <g className="plant-5">
          <path
            d="M901.464 895.8C897.671 912.458 912.41 938.153 912.41 938.153H928.408C928.408 938.153 916.099 916.855 918.304 902.576C919.749 893.216 928.149 890.022 928.408 880.553C928.683 870.48 917.877 866.903 918.304 856.835C918.692 847.67 928.984 844.814 928.408 835.659C927.755 825.292 915.193 824.485 912.41 814.482C910.371 807.156 912.41 795 912.41 795C912.41 795 902.809 803.6 901.464 811.094C899.607 821.44 913.794 825.239 912.41 835.659C911.334 843.757 902.071 845.3 901.464 853.447C900.771 862.742 912.41 865.302 912.41 874.624C912.41 883.945 903.532 886.714 901.464 895.8Z"
            fill="#2F6D6C"
          />
          <path
            d="M931.895 896.922C929.349 909.539 939.244 929 939.244 929H949.985C949.985 929 941.721 912.868 943.201 902.054C944.172 894.965 949.811 892.545 949.985 885.374C950.17 877.744 942.915 875.035 943.201 867.41C943.462 860.469 950.372 858.305 949.985 851.371C949.547 843.519 941.113 842.908 939.244 835.332C937.875 829.783 939.244 820.576 939.244 820.576C939.244 820.576 932.798 827.09 931.895 832.766C930.649 840.602 940.174 843.479 939.244 851.371C938.522 857.504 932.303 858.673 931.895 864.844C931.431 871.884 939.244 873.823 939.244 880.883C939.244 887.943 933.284 890.04 931.895 896.922Z"
            fill="#2F6D6C"
          />
          <path
            d="M884.305 908.436C882.453 918.884 889.649 935 889.649 935H897.461C897.461 935 891.451 921.641 892.527 912.686C893.233 906.815 897.334 904.811 897.461 898.872C897.595 892.554 892.319 890.311 892.527 883.996C892.717 878.248 897.742 876.456 897.461 870.714C897.142 864.212 891.008 863.705 889.649 857.432C888.654 852.836 889.649 845.212 889.649 845.212C889.649 845.212 884.961 850.606 884.305 855.306C883.398 861.795 890.325 864.178 889.649 870.714C889.124 875.793 884.601 876.761 884.305 881.871C883.967 887.701 889.649 889.307 889.649 895.153C889.649 901 885.315 902.737 884.305 908.436Z"
            fill="#2F6D6C"
          />
        </g>
        <g className="plant-5">
          <path
            d="M1164.46 768.8C1160.67 785.458 1175.41 811.153 1175.41 811.153H1191.41C1191.41 811.153 1179.1 789.855 1181.3 775.576C1182.75 766.216 1191.15 763.022 1191.41 753.553C1191.68 743.48 1180.88 739.903 1181.3 729.835C1181.69 720.67 1191.98 717.814 1191.41 708.659C1190.76 698.292 1178.19 697.485 1175.41 687.482C1173.37 680.156 1175.41 668 1175.41 668C1175.41 668 1165.81 676.6 1164.46 684.094C1162.61 694.44 1176.79 698.239 1175.41 708.659C1174.33 716.757 1165.07 718.3 1164.46 726.447C1163.77 735.742 1175.41 738.302 1175.41 747.624C1175.41 756.945 1166.53 759.714 1164.46 768.8Z"
            fill="#2F6D6C"
          />
          <path
            d="M1194.9 769.922C1192.35 782.539 1202.24 802 1202.24 802H1212.98C1212.98 802 1204.72 785.868 1206.2 775.054C1207.17 767.965 1212.81 765.545 1212.98 758.374C1213.17 750.744 1205.91 748.035 1206.2 740.41C1206.46 733.469 1213.37 731.305 1212.98 724.371C1212.55 716.519 1204.11 715.908 1202.24 708.332C1200.88 702.783 1202.24 693.576 1202.24 693.576C1202.24 693.576 1195.8 700.09 1194.9 705.766C1193.65 713.602 1203.17 716.479 1202.24 724.371C1201.52 730.504 1195.3 731.673 1194.9 737.844C1194.43 744.884 1202.24 746.823 1202.24 753.883C1202.24 760.943 1196.28 763.04 1194.9 769.922Z"
            fill="#2F6D6C"
          />
          <path
            d="M1147.3 781.436C1145.45 791.884 1152.65 808 1152.65 808H1160.46C1160.46 808 1154.45 794.641 1155.53 785.686C1156.23 779.815 1160.33 777.811 1160.46 771.872C1160.6 765.554 1155.32 763.311 1155.53 756.996C1155.72 751.248 1160.74 749.456 1160.46 743.714C1160.14 737.212 1154.01 736.705 1152.65 730.432C1151.65 725.836 1152.65 718.212 1152.65 718.212C1152.65 718.212 1147.96 723.606 1147.3 728.306C1146.4 734.795 1153.33 737.178 1152.65 743.714C1152.12 748.793 1147.6 749.761 1147.3 754.871C1146.97 760.701 1152.65 762.307 1152.65 768.153C1152.65 774 1148.31 775.737 1147.3 781.436Z"
            fill="#2F6D6C"
          />
        </g>
        <path
          className="ground"
          d="M1512 603V1513L0 1513V635C0 635 21.9298 694.83 39.5 689.5C84 676 67.8506 807.809 90.5 799C111.428 790.861 119.342 832.359 141.5 836C176.088 841.684 190.424 860.897 223.5 872.5C260.547 885.496 283.789 884.483 321 897C373.447 914.642 394.505 950.577 449.5 956.709C511.037 963.57 541.421 923.478 603 917C669.516 910.003 707.429 932.949 774 926.5C841.407 919.97 894.135 938.061 958.5 917C1011.98 899.5 1029.07 836 1073.5 836C1127 836 1133.52 790.371 1190.5 792.5C1228.47 793.918 1265.5 836 1303.5 836C1371 836 1356.75 738.233 1407 759.5C1446.64 776.275 1512 603 1512 603Z"
          fill="#2F5C6D"
        />
      </g>
    </StyledSvg>
  );
};
